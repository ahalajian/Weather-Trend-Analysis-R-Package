---
title: "Untitled"
output: html_document
date: "2024-04-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
load("allweather.RData")
library("dplyr")
data

```

#function 1
```{r}

extract_time_series <- function(station, start = as.Date("2000-01-01"), end = as.Date("2024-05-07")){
  this_station <- data |> filter(WBANNO == station & start <= LST_DATE & end >= LST_DATE)
  return(this_station)
}
```

#test case 1
```{r}
extract_time_series(53878, "2010-01-01", "2019-02-02")
```


#function 2

```{r}
yearly_cycle <- function(station){
  day <- as.integer(format(data[["LST_DATE"]], "%j"))
  #data$day <- format(data[["LST_DATE"]], "%j")
  result <- data |> dplyr::filter(WBANNO == station) |> dplyr::group_by(day = as.integer(format("LST_DATE", "%j"))) |> dplyr::summarize(expected_avg_temp = mean(T_DAILY_AVG, na.rm = TRUE))
  return(as.data.frame(result))
}

```
#test case 1
```{r}
yearly_cycle(53878)
```
#function 3
```{r}
trend_estimate <- function(){
  data$year <- as.numeric(format(data[["LST_DATE"]], "%y"))
  model <- lm(T_DAILY_AVG ~ year, data = data)
  temp_trend <- coef(model)[2]
  return(temp_trend)
}
```

```{r}
trend_estimate()
```
#function 4
```{r}
library("maps")
library("sp")
```

```{r}
create_grid_pts <- function(resolution = 0.1) {
  # Load the map data for the contiguous USA
  usa_map <- map("usa", plot = FALSE)

  # Extract the boundary coordinates of the contiguous USA
  usa_boundary <- usa_map$range
  
  # Create a grid of points within the boundary
  lon <- seq(usa_boundary[1], usa_boundary[2], by = resolution)
  lat <- seq(usa_boundary[3], usa_boundary[4], by = resolution)
  grid_points <- expand.grid(lon = lon, lat = lat)
 
  inside_usa <- which(point.in.polygon(grid_points$lon, grid_points$lat, usa_map$x[1:6886], usa_map$y[1:6886]) == 1)
  
  
  return(grid_points[inside_usa, ])
}
```


```{r}
library("maps")
library("sp")
plot(create_grid_pts(res = 1))
```



```{r}
interpolate_station_data <- function(){
  return (unique(data[!data$state %in% c("ON", "SA", "HI", "AK"), c("station_name", "LONGITUDE", "LATITUDE")]) )
}
```

```{r}
interpolate_station_data()
```


```{r}
plot_interpolations <- function(interpolations, usa_grids){
  map("usa")
  points(usa_grids)
  points(interpolations$LONGITUDE, interpolations$LATITUDE, pch = "x", cex = 0.5)
}
```

```{r}
plot_interpolations(interpolate_station_data(), create_usa_grid(resolution = 1))
```

